---
layout: post
title: "BabyTwo - Hack The Box"
summary: "SMB null enumeration → homes share username enumeration → RID brute-force → desktop.ini NTLM theft deployment via responder → credentials obtained (carl.moore:carl.moore) → sysvol share access via LDAP → startup script modification with reverse shell → login.vbs PowerShell reverse shell injection → BloodHound analysis (WriteDACL over GPOAdm) → ACL modification via bloodyAD → GenericAll over Group Policy Object → pyGPOAbuse for local administrators group privilege escalation"
---

# BabyTwo - Hack The Box

## Enumeration
### Nmap 
Initial Nmap scan revealed many standard ports for Domain Controllers.

<img width="1140" height="775" alt="00 - nmap" src="https://github.com/user-attachments/assets/99b0c07a-dc26-4629-9af3-86ab64cb8872" />

### SMB Null
SMB Null enumeration was allowed and it revealed some accessible shares.

<img width="1222" height="260" alt="01 - smb null" src="https://github.com/user-attachments/assets/81089c05-433d-4080-83f2-6f09aee40486" />

One of the shares was homes share which included usernames. I noted them. Morover, I put desktop.ini generated by ntlm_theft tool to each one of them and started responder.

<img width="1681" height="605" alt="03 - put ntlmtheft to everyone home" src="https://github.com/user-attachments/assets/e4d33c5e-f9e0-4c8d-b4cf-658653e4a6b2" />

To enhance my user list, I also applied rid brute forcing and noted these users too.

<img width="1382" height="684" alt="02 - rid userList" src="https://github.com/user-attachments/assets/cdd7b524-e6fd-454a-848d-aa4d2ff56a67" />

There was another share called apps and it included a .lnk file. 

<img width="933" height="395" alt="04 - apps" src="https://github.com/user-attachments/assets/d00c3823-2575-4da8-9a58-1172e5beeea2" />

I used [lnk-parse](https://sourceforge.net/projects/jafat/files/lnk-parse/lnk-parse-1.0/lnk-parse-1.0.tar.gz/download) tool to analyze it. It did not reveal any useful data other than startup scripts location.

<img width="1280" height="272" alt="05 - lnk parser" src="https://github.com/user-attachments/assets/05158aef-749e-48f9-9ab1-7ab22da0fca2" />

### Brute Forcing
Then, I applied brute forcing to SMB with username and password as username from previously generated user list. Found 2 valid credentials.

<img width="1222" height="275" alt="06 - username username" src="https://github.com/user-attachments/assets/89373e25-b081-4754-bc61-6749e47b0749" />

<img width="967" height="116" alt="06 - username username 2 library" src="https://github.com/user-attachments/assets/b3fedeec-4483-437c-82ba-a2a4b56b290a" />


### More SMB Enumeration
User Carl.Moore had READ access to the sysvol share which inlcudes startup scripts.

<img width="1246" height="262" alt="07 - sysvol" src="https://github.com/user-attachments/assets/5848d246-4966-4444-879b-ccf7afe29fba" />

At first I analyzed the login.vbs script and it was not useful.
<img width="773" height="579" alt="08 - login vbs nothing useful" src="https://github.com/user-attachments/assets/e2c432b0-3b40-4ae8-9456-2af0e0bab58f" />

Later I found out that, despite nxc was sayinng it was READ access, I could write into scripts folder. So at first I updated login.vbs script and added a reverse shell.

<img width="1522" height="705" alt="09 - 0 login vbs update" src="https://github.com/user-attachments/assets/2c7ef7af-3606-4ff9-959c-529ae361ba84" />

Then put it to scripts folder.

<img width="715" height="164" alt="09 - 1 put" src="https://github.com/user-attachments/assets/88653233-833f-4438-bb4e-226061824913" />

Then simply got a reverse powershell using netcat. Moreover, I got the user flag.

<img width="670" height="187" alt="09 - 2 user flag" src="https://github.com/user-attachments/assets/301132d7-f58c-45c0-b539-dff31d38e4d7" />

## Privilege Escalation
### BloodHound
The user Carl.Moore could authenticate using LDAP. So I ran bloodhoun-python using Carl.Moore's credentials.

<img width="1013" height="415" alt="09 - bloodhound python ldap" src="https://github.com/user-attachments/assets/eeb31714-543b-4d4d-a76c-88da76d40422" />

### WriteDACL over GPOADM
Analyzing the bloodhound revealed that current user in reverse shell (Amellia) had WriteDACL priviliges over GPOAdm user.

<img width="1017" height="441" alt="10 - writeDacl" src="https://github.com/user-attachments/assets/976ea5ff-0a4c-400c-8043-2ecc1750f11a" />

So at first, I updated ACL's and gave the Amellia GenericAll privileges over GPOAdm. Then I updated its password.

<img width="1169" height="154" alt="11 - updated gpoadm password" src="https://github.com/user-attachments/assets/44817c22-e9f9-4ab1-baa6-5cfdb1765327" />

### GenericAll over GPO
The GPOAdm user had GenericAll privileges over default domain policy object. 

<img width="1226" height="454" alt="12 - generic all" src="https://github.com/user-attachments/assets/fdf62552-d185-43ca-838f-2cdfe747b920" />

So I can abuse this using [pyGPOAbuse](https://github.com/Hackndo/pyGPOAbuse?tab=readme-ov-file) or [SharpGPOAbuse](https://github.com/FSecureLABS/SharpGPOAbuse) to add a new user to Local Admins group.

I used pyGPOAbuse and used its default options which adds john user to local administrators group with Password: 'H4x00r123..'

<img width="1314" height="86" alt="13 - pygpoabuse" src="https://github.com/user-attachments/assets/1bd810b1-fba4-497d-a348-fa7f943cd762" />

Then used xfreerdp3 to get an RDP session using new user.

<img width="1276" height="124" alt="14 - login" src="https://github.com/user-attachments/assets/ea9a1226-c7ce-4c80-b6ce-efda89af944c" />

And got the root flag.

<img width="900" height="398" alt="15 - flag" src="https://github.com/user-attachments/assets/58702269-40cf-4e81-af66-7042662ad779" />

## Pwned
Pwned it baby :)

<img width="891" height="827" alt="pwned" src="https://github.com/user-attachments/assets/f7aefce3-0859-4db9-aec7-42a9fc08f7ce" />

