# Baby - Hack The Box

## Enumeration
### Nmap 
Initial nmap scan revealed common ports for Active Directory.

<img width="1083" height="554" alt="00 - nmap output" src="https://github.com/user-attachments/assets/416014e7-d7b7-4d2d-ba99-d4fbefed09ff" />

### DNS Enumeration
Enumerating DNS records revealed the name of the DC.

<img width="913" height="329" alt="01 - 0 dc name" src="https://github.com/user-attachments/assets/58ee1b04-c94f-43a1-83e6-2f274621e617" />

### LDAP Anonymous
Anonymous LDAP connection was enabled and enumerating the LDAP with ldapsearch revealed a default password.

<img width="714" height="364" alt="01 - ldap anonymous" src="https://github.com/user-attachments/assets/81106907-a956-4a05-b353-965e1a9dfdbd" />

## Exploitation
Then I created a userList and applied password spraying but it did not work. I tried to password spray ldap, smb, wmi, winrm and none of them was successful.

<img width="840" height="439" alt="02 - userList" src="https://github.com/user-attachments/assets/1e3c0eef-3864-40fc-9825-22ff373b2229" />

Later, while checking the ldapsearch output I found another user which did not have any data attached to it so I could not grep the SamAccountName.

<img width="799" height="712" alt="03 - new suer" src="https://github.com/user-attachments/assets/8cab8b3a-cdda-424e-b11c-93edd97f0060" />

Trying this password with the found user worked but the password was expired. So I use smbpasswd to update the user's password.

<img width="1258" height="192" alt="04 - pass update" src="https://github.com/user-attachments/assets/d776c463-d1d3-445b-9443-860f3c6361a5" />

Then using evil-winrm, I got the shell and user flag.

<img width="1265" height="382" alt="05 - user" src="https://github.com/user-attachments/assets/b784dcb7-9327-4ca8-bc20-37d08487638c" />

## Privilege Escalation
The user had SeBackupPrivileges.

<img width="1479" height="783" alt="06 - privs" src="https://github.com/user-attachments/assets/5dc0429d-fb39-4d83-98c0-67739c5d9857" />

So it was an easy exploit. I followed exact steps in [k4sth4/SeBackupPrivilege](https://github.com/k4sth4/SeBackupPrivilege) repository, copied ntds.dit and SYSTEM files to my kali machine. Then used impacket's secretsdump to get Administrator's password hash.

<img width="1189" height="313" alt="07 - dump" src="https://github.com/user-attachments/assets/21413982-73c5-4dae-8be9-e1d42981c514" />

Then using impacket's psexec, I got the SYSTEM shell and root flag.

<img width="1199" height="311" alt="08 - root" src="https://github.com/user-attachments/assets/336910ac-4b42-4b56-8315-c2b8c844d5fe" />

## Pwned
The machine was fully compromised.

<img width="723" height="697" alt="pwned" src="https://github.com/user-attachments/assets/adaeea2b-c58b-47dd-a4e4-90c7282b3b56" />
