# Sweep - Hack The Box

## Enumeration
### Nmap
Initial nmap scan revealed SMB, LDAP, Kerberos and some non-default ports such as 81,82 were open.

<img width="1084" height="529" alt="00 - nmap" src="https://github.com/user-attachments/assets/1d4666ba-36e0-44fb-9c47-21c77c23d6d9" />

### SMB Null Session
SMB Null session was active and with the null session I got access to the IPC$ share. Thus, I can apply rid brute forcing attack.

<img width="1270" height="242" alt="01 - smb null" src="https://github.com/user-attachments/assets/6d9fe462-3c96-4fb9-8ef5-d2d007243036" />

<img width="1450" height="720" alt="02 - rid brute" src="https://github.com/user-attachments/assets/706502e7-2991-4468-8946-b0b0cad37c9e" />

### Brute Forcing
With the retrieved users, first I generated a userList.

<img width="822" height="303" alt="03 - userList" src="https://github.com/user-attachments/assets/6b8d26dc-2e79-4064-a468-469ebd983bae" />

Then I generated Brute Force list with null, reverse and same passwords as usernames.

<img width="1016" height="673" alt="04 - nsr wordlist" src="https://github.com/user-attachments/assets/a96021ce-4b7c-4933-bcdc-ba5752e9a7e6" />

The Brute Force revealed the user "intern" has the password "intern".

<img width="834" height="285" alt="05 - intern" src="https://github.com/user-attachments/assets/fa5bc487-fa13-4cee-aa1e-d2cd9e312731" />

## Exploitation
### Lansweeper
Lansweeper is an IT discovery & inventory platform which delivers insights into the status of users, devices, and software within IT environments. This platform inventories connected IT devices, enabling organizations to centrally manage their IT infrastructure.

The port 81 was Web interface of Lansweeper which can be logged on using domain credentials. I used "intern:intern" to login the Lansweeper dashboard.

<img width="1245" height="583" alt="06 - intern with sweep vl" src="https://github.com/user-attachments/assets/60ffc865-5bee-4245-b332-78dcb5b43dad" />

With the lansweeper, we can run credentialed scan to discover assets. At first I checked which credentials were saved.

<img width="1920" height="673" alt="07 - saved creds" src="https://github.com/user-attachments/assets/dbb8d4a9-6216-419c-aaa6-130418af7a4c" />

There were two service account credentials saved. One of them was a linux service account. I can create an SSH honeypot with [sshesame](https://github.com/jaksi/sshesame), and run credentialed scan to my machine to capture password of the service account.

<img width="886" height="314" alt="08 - listener" src="https://github.com/user-attachments/assets/a2cf9078-dcf3-42bf-aee6-97010bb5a9a5" />

<img width="1474" height="684" alt="09 - started" src="https://github.com/user-attachments/assets/4ba382b1-30a3-49e7-9fd5-d364da24a1fa" />

<img width="1321" height="413" alt="10 - password" src="https://github.com/user-attachments/assets/2e4ddb98-4524-4484-bec3-ff6ac014aa6b" />

With the obtained credentials, I ran BloodHound to analyze further. The service account had generic all privileges over "Lansweeper Admins" group which could winRM to the DC.

<img width="1177" height="564" alt="11 - initial" src="https://github.com/user-attachments/assets/4dd7db05-b319-4546-bde9-750c5af7246f" />

So I simply added service account to the "Lansweeper Admins" group, and using evil-winrm got a shell and user flag.

<img width="1426" height="830" alt="12 - remote" src="https://github.com/user-attachments/assets/8764ebce-f97f-459b-a6df-3718e4bd46a3" />

## Privilege Escalation
I first checked BloodHound which did not reveal any path to Administrator. Then ran winPEAS which also did not reveal anything useful.

I then re-login to the Lansweeper but this time with the service account credentials. Because the service account was added to the Lansweeper Admins group, I could now see some additional functionalities such as deployment.

The deployment functionality allows us to run commands on specified machine. We can run these commands as users whom credentials are stored or as system account. System account did not work.

From the BloodHound output I knew that other service account was in the Administrators group.

<img width="1179" height="352" alt="admin" src="https://github.com/user-attachments/assets/64800e15-e17d-4272-8db2-2c3b0e4844f6" />

Thus, I simply mapped the other service account credentials to Domain Controller.
<img width="1920" height="887" alt="13 - creds" src="https://github.com/user-attachments/assets/25ca311b-02e4-4dfb-9194-c6cfba55c055" />

Then I tested if I can run commands as the user. I tried 'powershell.exe echo "test" > test.txt' and it worked.

<img width="1920" height="875" alt="14 - deployment" src="https://github.com/user-attachments/assets/38b374e2-4cbb-455b-ac85-a19c9389a75b" />

I then updated the command, then downloaded [Invoke-PowerShellTcp.ps1](https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1) and started a python web server.

<img width="1629" height="792" alt="15 - change deployment" src="https://github.com/user-attachments/assets/0ddf2b10-1345-4085-8c3b-03ce07197613" />

Starting a netcat listener and deploying the command got me the Administrator shell.

<img width="1110" height="430" alt="16 - gg" src="https://github.com/user-attachments/assets/2586094a-e31e-4bff-a381-02a4a7dcedca" />

## Pwned
The machine was fully pwned.

<img width="729" height="694" alt="17 - pwned" src="https://github.com/user-attachments/assets/d8c66e4e-3ae7-4345-a700-a2d59cf1e74f" />
