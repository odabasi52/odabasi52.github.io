# Data - Hack The Box

## Enumeration
### Nmap
Initial nmap scan revealed Port 3000 and Port 22 (SSH) were open.

<img width="801" height="277" alt="00 - nmap" src="https://github.com/user-attachments/assets/be049ea6-c33e-4d66-b4dd-cdc06e919013" />

### Web Enumeration
Visiting the port 3000 revealed a grafana website.

<img width="1249" height="803" alt="01 - web" src="https://github.com/user-attachments/assets/ff6f93ad-fd8e-49a5-9c81-cf6f4a167c58" />

Later, I checked grafana version and found out it was vulnerable to Path Traversal.

<img width="1093" height="522" alt="02 - path traversal" src="https://github.com/user-attachments/assets/862c4087-09dc-4616-aff5-05af832c0e60" />

## Exploitation
### CVE-2021-43798
Searching through the internet, I found the config file location of grafana. It included secret_key and other informations. At first I tried to decrypt datasource password but I could not.

Then further enumeration revealed sqlite db named grafana.db.

<img width="1579" height="426" alt="grafanadb" src="https://github.com/user-attachments/assets/a8a26550-a065-4ee5-853e-6b17e86e28dd" />

<img width="1100" height="343" alt="grafanadb2" src="https://github.com/user-attachments/assets/9307f60c-ea2a-4b2c-a481-e0a0d3ee0170" />

I downloaded it using curl. After the download, I enumerated the sqlite db and found salted hashes on the database.

<img width="1757" height="756" alt="03 - grafana passwords" src="https://github.com/user-attachments/assets/6c586703-f7d6-4eeb-9194-567c7579810e" />

Using the [grafana2hashcat](https://github.com/iamaldi/grafana2hashcat) tool, I generated cracable password format, then run hashcat using rockyour.txt file.

<img width="1158" height="706" alt="04 - hashes" src="https://github.com/user-attachments/assets/d6e98f40-225a-4abc-951d-e2a7734ff979" />

The hash of the boris was cracked.

<img width="909" height="77" alt="05 - cracked" src="https://github.com/user-attachments/assets/561f044f-407b-4087-881e-751cf47fa756" />

I logged in and got the user flag.

<img width="832" height="533" alt="06 - user flag" src="https://github.com/user-attachments/assets/6fc9b904-6fe0-48fa-9a36-1c5812afa60e" />

## Privilege Escalation
The "sudo -l" command revealed I can run "docker exec" command as sudo.

<img width="997" height="99" alt="07 - sudo l" src="https://github.com/user-attachments/assets/fa8ee436-318c-43cc-b6eb-7957023c7a49" />

To run it I need to find the container id or container name. I could not run docker ps or docker container ls. So at first I tried random names and one of the names were true: "grafana".

However, it is not a dependable solution. So I tried another method, I checked running processes and grepped docker. This revealed the container id.

<img width="1901" height="183" alt="08  - docker id" src="https://github.com/user-attachments/assets/87e726d0-bed2-49e5-8114-cefb3e67812a" />

After learning the container id, I checked for mounts on the current machine. The /dev/sda1 mount was on the / path.

<img width="980" height="290" alt="09 - 0 mount" src="https://github.com/user-attachments/assets/29376ee5-eee9-445f-9bec-03a73fd45a3f" />

Thus, with the container id I got a root shell on the container. Then mounted the /dev/sda1 to access to host machines root folder and got the root flag.

<img width="1167" height="83" alt="09 - shell on docker" src="https://github.com/user-attachments/assets/557625f5-2de9-4ea9-b9fd-b0078c37aa36" />

<img width="293" height="105" alt="10 - mount" src="https://github.com/user-attachments/assets/b5dbb647-edf9-4102-b253-c380d8fa5fed" />

## Pwned
The machine was pwned.

<img width="719" height="692" alt="pwned" src="https://github.com/user-attachments/assets/adbd8c22-53e0-455c-b3cf-3f13022ed01d" />
