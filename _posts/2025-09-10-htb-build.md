
# Build - Hack The Box

## Enumeration
### Nmap 
Initial nmap scan revealed Rsync, Rlogin, Port 3000 (HTTP), SSH, DNS ports were open and MySQL port was filtered.

<img width="861" height="326" alt="00 - nmap" src="https://github.com/user-attachments/assets/4d75395f-c414-4290-a72c-e70c8d84e54d" />

### Web Enumeration
Website was gitea. The version was not vulnerable.

<img width="1465" height="818" alt="01 - gitea" src="https://github.com/user-attachments/assets/85e53f3f-3fde-4147-817a-083c4c4c8c61" />

There was a user named buildadm and a dev repo which included a Jenkins file.

<img width="1470" height="531" alt="02 - Jenkinsfile repo and nothing else" src="https://github.com/user-attachments/assets/2620f701-220b-418e-9702-328269424e6b" />

### Rsync Enumeration
I did not know what to do with rsync. But checking the [Rsync Pentesting](https://hackviser.com/tactics/pentesting/services/rsync) documentation from Hackviser, I understood that it could be used to transfer files.

It can either be authenticated or unauthenticated. I checked if authentication was diabled. It was indeed disabled. I transfered jenkins backup files to my computer.

<img width="559" height="195" alt="03 - rsync download" src="https://github.com/user-attachments/assets/dc987c49-c680-4dcc-bc84-6ec71e1f616c" />

### Jenkins Decryption
I searched through the internet to understand what to do with jenkins configuration files. I found out that there are encrypted user passwords. Searching through the internet I found [jenkins-credential-decryptor](https://github.com/hoto/jenkins-credentials-decryptor) tool. Using it revealed the password for buildadm user.

<img width="1619" height="176" alt="04 - decrypted" src="https://github.com/user-attachments/assets/36cc6729-51d8-4eb0-8ad7-5696243e2d3b" />

### Jenkins File RevShell
I logged in using the buildadm user, then simply updated the Jenkinsfile and got the reverse shell.

<img width="1441" height="413" alt="05 - got the user flag" src="https://github.com/user-attachments/assets/57f6816b-f65c-4a17-b8bc-7f7abd9ef3f2" />

## Privilege Escalation
Checking the environment, I understood that I was in a docker container as a root user. I could not run many commands. So at first I checked my IP address to find out docker container's subnet. It was in a different subnet than host machine.

<img width="632" height="402" alt="06 - IP check" src="https://github.com/user-attachments/assets/ca552330-50cf-4052-8873-9281a7a05824" />

### .rhosts file
Then searching through the files, I found out .rhosts file. I did not know what to do with it. So I searched through the internet and found out [this](https://phoenixnap.com/glossary/rhosts) website.

Rhosts file is used to control remote logins through rsh or rlogin. In the current machine, Users on the intern.build.vl and admin.build.vl could login as root on the machine.

<img width="338" height="66" alt="07 - 0 rhosts" src="https://github.com/user-attachments/assets/acd28337-5adb-49db-beb9-ecba40845450" />

### Static Nmap
Keeping this information in mind, I downloaded [static-nmap binary](https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/nmap) and transfered it with /etc/services file to the target container using curl.

Running it revealed the IPs and ports.

<img width="1217" height="792" alt="07 - static nmap output" src="https://github.com/user-attachments/assets/0dd59b6a-c42d-48c1-8a8a-7666b8061336" />

### Chisel
After running the nmap, I ran chisel to create a socks proxy using below steps:

1. Update the `/etc/proxychains4.conf`
    
    ```powershell
    #socks4 127.0.0.1 9050
    socks5  127.0.0.1 1080
    ```
    
2. Set Reverse Listener on attacker site:
    
    ```bash
    chisel server --reverse --port 443
    ```
    
3. Set client on the victim side:
    
    ```bash
    chisel.exe client 10.10.16.11:443 R:1080:socks
    ```
    
4. Now we can access the internal network.

Then connected to mysql database.

<img width="864" height="423" alt="08 - proxychains db" src="https://github.com/user-attachments/assets/ffa19219-7cc1-48c5-ad17-a19b3f80e066" />

Checking the records, I found a password.

<img width="1314" height="134" alt="09 - cracked" src="https://github.com/user-attachments/assets/912895ed-2f1b-47eb-8290-473bdd70318b" />

Then using the hashcat, cracked the password.

<img width="756" height="90" alt="10 - cracked real" src="https://github.com/user-attachments/assets/7535d676-d825-4660-b2ff-04d0119bca82" />

### Internal Web Enumeration
Now from the nmap output, we know there are some internal websites. At first I set socks proxy on firefox.

<img width="756" height="447" alt="11 - set proxy" src="https://github.com/user-attachments/assets/9a18f61a-8625-4397-a41f-b19733347c49" />

Then visited the website which revealed PowerDNS-Admins Website. Previously, I cracked the password inside the powerdnsadmins database, so I tried that credentials and logged in.

<img width="1324" height="642" alt="12 - admin" src="https://github.com/user-attachments/assets/9fdda635-0445-4ab6-9054-79fb1858a9cc" />

### Rhosts
Previously, I found the .rhosts file inside the docker container. I may assume that same .rhosts file is present on the host domain. So if I update intern or add a new admin record which points to my attacker machine IP, I may login to the target host machine as root using rsh without password.

So I added an admin record which points to my host.

<img width="1463" height="813" alt="13 - rhosts" src="https://github.com/user-attachments/assets/965f91f9-9097-4381-b712-56334e94556f" />

Then simply logged in and got the root flag.

<img width="1226" height="581" alt="14 - root txt" src="https://github.com/user-attachments/assets/a1f1994d-0159-4925-9add-20183f65bb85" />

## Pwned
The machine was compromised.

<img width="732" height="700" alt="15 - pwned" src="https://github.com/user-attachments/assets/e1302e69-52b9-40e4-aa27-585bae173a09" />
